<!DOCTYPE html>
<html ng-app="app">
	<head>
		<title>Cart</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="/stylesheets/bootstrap.min.css" rel="stylesheet"/>
		<link rel="stylesheet" href="/stylesheets/numpad.css" />
		<link href="/bower_components/bootstrap-toggle/css/bootstrap-toggle.min.css" rel="stylesheet"/>

		<script src="/javascripts/jquery-1.11.2.min.js" type="text/javascript"></script>
		<script src="/javascripts/js.cookie-2.1.1.min.js" type="text/javascript"></script>
		<script src="/bower_components/angular/angular.js"></script>
		<script src="/bower_components/angular-bootstrap/ui-bootstrap.min.js"></script>

		<script src="/bower_components/bootstrap-toggle/js/bootstrap-toggle.min.js"></script>
		<script src="/javascripts/numpad.js" type="text/javascript"></script>
		<script src="/javascripts/includes.js" type="text/javascript"></script>
		<style type="text/css">
			@media only screen and (min-width:640px){
				body {
			   		font-size: 20px;
				}
				.row{
  					margin-top: 10px;
  					margin-bottom: 10px
				}
			}
		</style>
	</head>
	<body ng-controller="bodyController">
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="container-fluid">
				<div class="navbar-header">
	      			<button class=" btn" style="margin-top:8px;" onclick="window.history.back();">
						<b>&#8678;</b> Back
					</button>
				</div>
				<div class="nav navbar-nav navbar-right" style="padding: 10px;">
					<input type="checkbox" id="langToggle">
				</div>
			</div>
		</nav>
		<br>
		<br>

		<div class="container">
			<div class="row">
				<label class="control-label	col-xs-2" for="metalTxt">Customer Name:</label>
				<div class="col-xs-4">
					<input type="text" ng-model="marVal" class="input-md form-control" id="marTxt">
				</div>
				<label class="control-label	col-xs-1" for="metalTxt">Phone:</label>
				<div class="col-xs-5">
					<input type="text" ng-model="marVal" class="input-md form-control" id="marTxt">
				</div>
			</div>
			<div class="row">
				<label class="control-label	col-xs-2" for="metalTxt">Address:</label>
				<div class="col-xs-10">
					<input type="text" ng-model="marVal" class="input-md form-control" id="marTxt">
				</div>
			</div>
			<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
			<div class="row">
				<div class="h3 col-xs-8">Sales Articles</div>
				<div class="col-xs-4 text-right">
  					<button id="addSalesBtn" ng-click="addSales()" class="btn btn-primary btn-md">Add {{New}} Article to Sales</button>
				</div>
			</div>

			<table class="table table-striped">
    			<thead>
					<tr>
						<th>Metal</th>
						<th>Category</th>
						<th>{{Karat}}</th>
						<th>{{netWeight}}</th>
						<th>{{grossWeight}}</th>
						<th>{{Wages}}</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="article in sales_articles">
						<td>
							{{article.metal}}
						</td>
						<td>
							{{article.category.name}}
						</td>
						<td>
							{{article.karat}}
						</td>
						<td>
							{{article.netWeight}}
						</td>
						<td>
							{{article.grossWeight}}
						</td>
						<td>
							{{article.wages}}
						</td>
					</tr>
				</tbody>
			</table>
			
			<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
			<h3>Resell Articles</h3>
			<div>
			</div>
			<hr style="margin-bottom:5px !important; margin-top:5px !important; " />
			<div class="row">
				<div class="col-xs-9">
					<h2>Total</h2>
				</div>
				<div class="col-xs-3 h2 text-primary bg-warning">
					{{Total_amount}} &#8377;
				</div>
		</div>

		<script type="text/javascript">
			$(function(){
				var cartNo = Cookies.get("cartNo");
				if(!cartNo){
					Cookies.set("cartNo", 1);
					window.location.href = "cart/1";
				}else{
					if(window.location.pathname == "/cart"){
						window.location.href = "cart/#/"+cartNo;
					}
				}
			});
			angular
				.module('app',['ui.bootstrap'])
				.controller("bodyController",['$scope', '$http', '$location', function($scope, $http, $location){
					window.scope = $scope;
					window.http = $http;

					l([{
						New:"New",
						Article:"Article",
						Todays : "Today's",
						"rate" : "rate",
						grossWeight : "Gross Weight",
						netWeight : "Net Weight",
						Karat  : "Karat",
						Wages  : "Wages"
					}]);
					
					var g_rate = Cookies.get("gold_rate");
					var s_rate = Cookies.get("silver_rate");

					$scope.Total_amount = 0;
					$scope.gold_rate = (g_rate) ? g_rate : "00.00";
					$scope.silver_rate = (s_rate) ? s_rate : "00.00";

					$scope.$watch('lang', function() {
						if(window.scope.lang){
							window.toggle.bootstrapToggle((window.scope.lang == "eng")?'on':'off');
						}
					});

					$scope.$watch('gold_rate', function() {
						Cookies.set("gold_rate", $scope.gold_rate);
					});
					
					$scope.$watch('silver_rate', function() {
						Cookies.set("silver_rate", $scope.silver_rate);
					});
					$scope.sales_articles = [];
					$scope.addSales = function(){
						var id = prompt("Please enter Article ID");
						$.get("/api/stock/"+id,function(s, r){
							$scope.$apply(function() {
								console.log(s);
								$scope.sales_articles.push(s);
							});
						}).fail(function() {
							alert("Wrong ID");
						});
					}
					$(function(){
						window.toggle = $("#langToggle").bootstrapToggle({
							on: 'English',
							off: 'Marathi',
							offstyle:"warning"
						}).change(function() {
							window.scope.lang = $(this).prop('checked') ? "eng" : "mar";
							l([window.obj]);
							Cookies.set("my_lang_settings", window.scope.lang);
							
						});
						$(".gold").numpad({
							target : $("#test"),
							onChange : function(e, val){
								$scope.$apply(function() { 
									window.scope.gold_rate = val;
								});
							}
						});
						$(".silver").numpad({
							target : $("#test"),
							onChange : function(e, val){
								$scope.$apply(function() { 
									window.scope.silver_rate = val;
								});
							}
						});

						var lang = Cookies.get("my_lang_settings");
						if(lang){
							window.scope.lang = lang;
						}else{
							if(!window.scope.lang){
								window.toggle.bootstrapToggle("off");
							}
						}
						
						if(window.scope.lang == "eng"){
							window.toggle.bootstrapToggle('on');
						}
					});
			}]);
		</script>
	</body>
</html>